# Story 1.6: Implement Dynamic Version Number Replacement

## Status
Draft

## Story
**As a** Content Creator,  
**I want** to use text variables (e.g., `$release-core-7-variable`) in my articles,  
**so that** product version numbers are automatically updated across the entire site from a single, central configuration.

## Acceptance Criteria
1. Text variables in format `$variable-name` are automatically replaced across all content
2. Version numbers are maintained in a central configuration that's easy to update
3. Variable replacement works for all product versions and components
4. Implementation supports both inline text and code block variable replacement
5. Variable replacement occurs dynamically without requiring content republishing
6. System works across all four knowledge base product sections

## Tasks / Subtasks
- [ ] Design variable configuration system (AC: 2, 3)
  - [ ] Create centralized variable configuration structure
  - [ ] Define variable naming conventions for different products
  - [ ] Implement configuration loading and caching mechanism
  - [ ] Create admin interface or file-based configuration management
- [ ] Implement variable detection and replacement (AC: 1, 4)
  - [ ] Create regex pattern for variable detection (`$variable-name` format)
  - [ ] Implement text replacement logic for inline content
  - [ ] Handle variable replacement in code blocks and preformatted text
  - [ ] Ensure replacement preserves HTML structure and formatting
- [ ] Set up dynamic replacement system (AC: 5, 6)
  - [ ] Integrate with SPA page load detection from Story 1.2
  - [ ] Implement real-time variable replacement on page changes
  - [ ] Handle content updates without page refresh
  - [ ] Test replacement across all knowledge base sections
- [ ] Test variable replacement functionality (AC: 6)
  - [ ] Verify replacement accuracy across different content types
  - [ ] Test configuration updates and propagation
  - [ ] Validate performance impact on page load times

## Dev Notes

### Relevant Source Tree Info
- **Integration Point**: Part of consolidated JavaScript from Story 1.2
- **Configuration Location**: Centralized variable configuration (JSON or similar)
- **Target Scope**: All four knowledge base product sections

### Technical Context
From architecture documentation and requirements, the version replacement system provides:

1. **Centralized Management**: Single source of truth for all version numbers
2. **Dynamic Replacement**: Real-time text replacement without content republishing
3. **Multi-Product Support**: Variables for iText Core, pdfHTML, pdfSweep, and other products
4. **SPA Compatibility**: Works with Refined.com's dynamic page loading

### Key Implementation Requirements
- **Variable Format**: `$variable-name` pattern for easy identification
- **Central Configuration**: JSON or similar format for easy maintenance
- **Real-Time Updates**: Changes propagate immediately without republishing
- **Content Preservation**: Maintain HTML formatting and structure during replacement
- **Performance**: Minimal impact on page rendering speed

### Variable Configuration Structure
The system should support variables for:
- Product version numbers (e.g., `$release-core-7-variable`, `$release-pdfhtml-4-variable`)
- Component versions and dependencies
- Release dates and compatibility information
- Custom variables for specific product features

### Replacement Algorithm
- Scan page content after DOM ready and page changes
- Use regex to identify variable patterns
- Replace variables with configured values
- Preserve HTML structure and nested content
- Handle edge cases like variables in attributes or special contexts

### Configuration Management
- Centralized configuration file (JSON format recommended)
- Easy update mechanism for content creators
- Version control integration for configuration changes
- Caching strategy for performance optimization

### SPA Integration
- Use MutationObserver from Story 1.2 for page change detection
- Re-process content when new pages load
- Handle dynamic content updates efficiently
- Ensure replacements persist during navigation

### Testing Standards
- **Test Location**: All knowledge base product sections
- **Testing Framework**: Automated testing for variable replacement accuracy
- **Specific Requirements**:
  - Test variable replacement in various content types (paragraphs, lists, code blocks)
  - Verify configuration updates propagate correctly
  - Test performance impact with large numbers of variables
  - Validate HTML structure preservation during replacement
  - Cross-browser compatibility testing
  - SPA navigation testing to ensure replacements persist

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-23 | 1.0 | Initial story creation | Scrum Master |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

## QA Results  
*This section will be populated by the QA agent after implementation review*