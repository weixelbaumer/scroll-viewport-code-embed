<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GitHub Code - Direct Embed Generator</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <style>
    body {
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    .card {
      margin-bottom: 20px;
    }
    .result-code {
      background-color: #f8f9fa;
      padding: 15px;
      border-radius: 4px;
      border: 1px solid #dee2e6;
      font-family: monospace;
      white-space: pre-wrap;
      word-break: break-all;
      max-height: 300px;
      overflow-y: auto;
    }
    .preview-container {
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 20px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="mb-4">Direct Embed Generator for Scroll Viewport</h1>
    <p class="lead">This tool generates code you can directly paste into Confluence as HTML, which will work in Scroll Viewport</p>
    
    <div class="card">
      <div class="card-header">Enter GitHub Information</div>
      <div class="card-body">
        <form id="github-form">
          <div class="mb-3">
            <label for="github-url" class="form-label">GitHub URL</label>
            <input type="text" class="form-control" id="github-url" placeholder="https://github.com/user/repo/blob/main/path/to/file.java" required>
            <div class="form-text">Enter a GitHub URL or raw.githubusercontent.com URL</div>
          </div>
          
          <div class="mb-3">
            <label for="line-range" class="form-label">Line Range (optional)</label>
            <input type="text" class="form-control" id="line-range" placeholder="e.g., 10-20">
            <div class="form-text">Specify lines to display (e.g., 10-20)</div>
          </div>
          
          <div class="mb-3">
            <label for="theme" class="form-label">Theme</label>
            <select class="form-select" id="theme">
              <option value="github">GitHub Light</option>
              <option value="github-dark">GitHub Dark</option>
              <option value="monokai">Monokai</option>
              <option value="atom-one-dark">Atom One Dark</option>
              <option value="vs2015">VS2015</option>
              <option value="xcode">Xcode</option>
              <option value="dracula">Dracula</option>
            </select>
          </div>
          
          <button type="submit" class="btn btn-primary">Generate Embed Code</button>
        </form>
      </div>
    </div>
    
    <div id="result-container" style="display:none;" class="card">
      <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
          <span>Embed Code (Copy this to Confluence)</span>
          <button id="copy-button" class="btn btn-sm btn-outline-secondary">Copy to Clipboard</button>
        </div>
      </div>
      <div class="card-body">
        <p>Instructions:</p>
        <ol>
          <li>Copy the code below</li>
          <li>In Confluence, choose <strong>Insert &gt; Other macros</strong></li>
          <li>Search for "HTML" and select the HTML macro</li>
          <li>Paste this code and save</li>
        </ol>
        <div class="result-code" id="result-code"></div>
      </div>
    </div>
    
    <div id="preview-container" style="display:none;" class="preview-container">
      <h4>Preview</h4>
      <div id="preview-content"></div>
    </div>
    
    <div class="card mt-4">
      <div class="card-header bg-danger text-white">
        <h4 class="mb-0">Scroll Viewport Solution</h4>
      </div>
      <div class="card-body">
        <p class="alert alert-warning">Scroll Viewport removes HTML markup when generating content. Use this JavaScript method instead!</p>
        
        <h5>Method 1: Direct JavaScript (Recommended)</h5>
        <p>Insert this into the HTML macro in Confluence:</p>
        <pre class="bg-light p-3 mb-3"><code>&lt;script src="${window.location.origin}/scroll-viewport.js?url=YOUR_GITHUB_URL"&gt;&lt;/script&gt;</code></pre>
        
        <p>For example:</p>
        <pre class="bg-light p-3 mb-3"><code>&lt;script src="${window.location.origin}/scroll-viewport.js?url=https://github.com/itext/itext7/blob/develop/kernel/src/main/java/com/itextpdf/kernel/pdf/PdfDocument.java&lines=100-120&theme=github"&gt;&lt;/script&gt;</code></pre>
        
        <h5>Method 2: Text Markers (For Multiple Snippets)</h5>
        <p>First, add this script once at the top of your page using the HTML macro:</p>
        <pre class="bg-light p-3 mb-3"><code>&lt;script src="${window.location.origin}/scroll-viewport-marker.js"&gt;&lt;/script&gt;</code></pre>
        
        <p>Then, in your Confluence content, use text markers like this:</p>
        <pre class="bg-light p-3 mb-3">Here is an example of the PdfDocument class:

##GITHUB:https://github.com/itext/itext7/blob/develop/kernel/src/main/java/com/itextpdf/kernel/pdf/PdfDocument.java##

You can specify lines and theme:

##GITHUB:https://github.com/itext/itext7/blob/develop/kernel/src/main/java/com/itextpdf/kernel/pdf/PdfDocument.java:100-120:dracula##</pre>
      </div>
    </div>
  </div>
  
  <script>
    document.getElementById('github-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Get values from form
      const githubUrl = document.getElementById('github-url').value.trim();
      const lineRange = document.getElementById('line-range').value.trim();
      const theme = document.getElementById('theme').value;
      
      if (!githubUrl) {
        alert('Please enter a GitHub URL');
        return;
      }
      
      // Fetch current server URL
      const serverUrl = window.location.origin;
      
      // First: Generate the HTML snippet
      fetchCodeAndGenerateEmbed(githubUrl, lineRange, theme, serverUrl);
    });
    
    function fetchCodeAndGenerateEmbed(githubUrl, lineRange, theme, serverUrl) {
      // Show loading
      document.getElementById('result-container').style.display = 'block';
      document.getElementById('result-code').textContent = 'Loading...';
      document.getElementById('preview-container').style.display = 'block';
      document.getElementById('preview-content').innerHTML = '<div style="text-align: center; padding: 20px;">Loading preview...</div>';
      
      // Construct URL to fetch the HTML directly
      const fetchUrl = `${serverUrl}/html?url=${encodeURIComponent(githubUrl)}${lineRange ? '&lines=' + encodeURIComponent(lineRange) : ''}&theme=${encodeURIComponent(theme)}`;
      
      // Fetch the HTML content
      fetch(fetchUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error(`Failed to load code: ${response.status} ${response.statusText}`);
          }
          return response.text();
        })
        .then(html => {
          // Create the HTML with inline styles for Scroll Viewport compatibility
          const embedCode = html;
          
          // Display the result
          document.getElementById('result-code').textContent = embedCode;
          document.getElementById('preview-content').innerHTML = embedCode;
        })
        .catch(error => {
          document.getElementById('result-code').textContent = `Error: ${error.message}`;
          document.getElementById('preview-content').innerHTML = `<div style="color: red; padding: 10px; background: #ffeeee; border-radius: 4px;">Error: ${error.message}</div>`;
        });
    }
    
    // Copy to clipboard functionality
    document.getElementById('copy-button').addEventListener('click', function() {
      const codeElement = document.getElementById('result-code');
      const textToCopy = codeElement.textContent;
      
      navigator.clipboard.writeText(textToCopy)
        .then(() => {
          // Change button text temporarily
          const button = this;
          const originalText = button.textContent;
          button.textContent = 'Copied!';
          button.classList.remove('btn-outline-secondary');
          button.classList.add('btn-success');
          
          setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove('btn-success');
            button.classList.add('btn-outline-secondary');
          }, 2000);
        })
        .catch(err => {
          console.error('Failed to copy text: ', err);
          alert('Failed to copy to clipboard. Please try selecting the text manually.');
        });
    });
  </script>
</body>
</html> 