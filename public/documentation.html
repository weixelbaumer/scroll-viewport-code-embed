<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>GitHub Code Renderer Documentation</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            color: #172B4D;
            background-color: #F4F5F7;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 30px 20px;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        h1 {
            border-bottom: 1px solid #DFE1E6;
            padding-bottom: 10px;
            margin-top: 0;
            color: #172B4D;
        }
        h2 {
            margin-top: 30px;
            color: #172B4D;
            border-bottom: 1px solid #F4F5F7;
            padding-bottom: 5px;
        }
        h3 {
            margin-top: 20px;
            color: #172B4D;
        }
        code {
            background-color: #F4F5F7;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 90%;
        }
        pre {
            background-color: #F4F5F7;
            padding: 15px;
            border-radius: 3px;
            overflow-x: auto;
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 90%;
        }
        .note {
            background-color: #E3FCEF;
            border-left: 4px solid #36B37E;
            padding: 15px;
            margin: 15px 0;
            border-radius: 3px;
        }
        .warning {
            background-color: #FFFAE6;
            border-left: 4px solid #FFAB00;
            padding: 15px;
            margin: 15px 0;
            border-radius: 3px;
        }
        .error {
            background-color: #FFEBE6;
            border-left: 4px solid #FF5630;
            padding: 15px;
            margin: 15px 0;
            border-radius: 3px;
        }
        img {
            max-width: 100%;
            border: 1px solid #DFE1E6;
            border-radius: 3px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 15px 0;
        }
        th, td {
            text-align: left;
            padding: 8px;
            border: 1px solid #DFE1E6;
        }
        th {
            background-color: #F4F5F7;
        }
        tr:nth-child(even) {
            background-color: #FAFBFC;
        }
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #DFE1E6;
            color: #6B778C;
            font-size: 14px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>GitHub Code Renderer Documentation</h1>
        
        <div class="note">
            <strong>Version:</strong> 1.1.3 - This Confluence app allows you to embed and render code snippets directly from GitHub repositories.
        </div>
        
        <h2 id="getting-started">Getting Started</h2>
        
        <h3>Adding a GitHub Code Block to a Confluence Page</h3>
        <ol>
            <li>Edit a Confluence page</li>
            <li>Place your cursor where you want to insert the code block</li>
            <li>Type "/" to open the macro browser and search for "GitHub Code Block"</li>
            <li>Select "GitHub Code Block" from the results</li>
            <li>Fill in the required information in the form that appears</li>
            <li>Click "Insert" to add the code block to your page</li>
        </ol>
        
        <h3>Required Parameters</h3>
        <table>
            <tr>
                <th>Field</th>
                <th>Description</th>
                <th>Example</th>
            </tr>
            <tr>
                <td>GitHub URL</td>
                <td>The full URL to a file in a GitHub repository</td>
                <td><code>https://github.com/user/repo/blob/main/file.js</code></td>
            </tr>
            <tr>
                <td>Line Range (Optional)</td>
                <td>Specific lines to display from the file</td>
                <td><code>10-20</code> or <code>15</code></td>
            </tr>
            <tr>
                <td>Theme (Optional)</td>
                <td>The syntax highlighting theme to use</td>
                <td>GitHub Light, GitHub Dark, etc.</td>
            </tr>
        </table>
        
        <h2 id="scroll-viewport-integration">Scroll Viewport Integration</h2>
        
        <p>To enable GitHub code blocks in your Scroll Viewport site, you need to add custom JavaScript to your Scroll Viewport theme:</p>
        
        <ol>
            <li>In your Scroll Viewport site, click <strong>Edit Theme</strong> from the site overview</li>
            <li>Go to the <strong>Templates</strong> menu</li>
            <li>In the <strong>Additional</strong> section, expand the JS editor</li>
            <li>Copy and paste the JavaScript code below</li>
            <li>Click <strong>Save</strong> to apply the changes</li>
        </ol>
        
        <pre><code class="language-javascript">// GitHub Code Renderer for Scroll Viewport
// Version 1.1.3

// Only run on live sites, not in previews
if (!vp.preview.isPagePreview() && !vp.preview.isSitePreview()) {
  // Load highlight.js for syntax highlighting
  vp.loadScript('https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js')
    .then(() => {
      // Load the theme CSS (default to github-light)
      const linkEl = document.createElement('link');
      linkEl.rel = 'stylesheet';
      linkEl.href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css';
      document.head.appendChild(linkEl);
      
      // Process GitHub code markers in the article content
      processGitHubCodeMarkers();
    });
}

function processGitHubCodeMarkers() {
  // Find all article content areas
  const contentAreas = document.querySelectorAll('.article-content, .confluence-content');
  
  contentAreas.forEach(content => {
    // Look for our markers using regex
    const markerRegex = /##GITHUB:([^|]+)\|([^|]*)\|([^#]*)##/g;
    const html = content.innerHTML;
    
    // Replace markers with actual code blocks
    content.innerHTML = html.replace(markerRegex, (match, url, lines, theme) => {
      // Create a placeholder while loading
      const id = 'gh-code-' + Math.random().toString(36).substring(2, 10);
      fetchGitHubCode(url, lines, theme, id);
      return `&lt;div id="${id}" class="github-code-block"&gt;
                &lt;div class="loading-indicator"&gt;Loading code from GitHub...&lt;/div&gt;
              &lt;/div&gt;`;
    });
  });
}

function fetchGitHubCode(url, lines, theme, containerId) {
  // Convert github.com URL to raw URL if needed
  let rawUrl = url;
  if (url.includes('github.com') && !url.includes('raw.githubusercontent.com')) {
    rawUrl = url.replace('github.com', 'raw.githubusercontent.com')
               .replace('/blob/', '/');
  }
  
  // Fetch the code
  fetch(rawUrl)
    .then(response => {
      if (!response.ok) {
        throw new Error(`Failed to fetch: ${response.status} ${response.statusText}`);
      }
      return response.text();
    })
    .then(code => {
      // Process line range if specified
      let processedCode = code;
      if (lines && lines.trim()) {
        const lineRange = lines.trim();
        const lineArray = code.split('\n');
        
        if (lineRange.includes('-')) {
          // Range of lines
          const [start, end] = lineRange.split('-').map(num => parseInt(num, 10));
          processedCode = lineArray.slice(start - 1, end).join('\n');
        } else {
          // Single line
          const lineNum = parseInt(lineRange, 10);
          processedCode = lineArray[lineNum - 1];
        }
      }
      
      // Render the code with highlight.js
      const container = document.getElementById(containerId);
      if (container) {
        // Determine language from file extension
        const fileExt = url.split('.').pop().toLowerCase();
        const pre = document.createElement('pre');
        const code = document.createElement('code');
        
        // Apply appropriate language class if determinable
        if (fileExt) {
          code.className = `language-${fileExt}`;
        }
        
        code.textContent = processedCode;
        pre.appendChild(code);
        container.innerHTML = '';
        container.appendChild(pre);
        
        // Apply highlighting
        if (window.hljs) {
          window.hljs.highlightElement(code);
        }
      }
    })
    .catch(error => {
      // Show error in the container
      const container = document.getElementById(containerId);
      if (container) {
        container.innerHTML = `&lt;div class="error-message"&gt;Error loading code: ${error.message}&lt;/div&gt;`;
      }
    });
}</code></pre>

        <div class="note">
            <p><strong>Note:</strong> This approach follows the official K15t Scroll Viewport documentation for <a href="https://help.k15t.com/scroll-viewport/inject-custom-javascript" target="_blank">injecting custom JavaScript</a>.</p>
        </div>
        
        <h2 id="features">Features</h2>
        <ul>
            <li><strong>Live Code Rendering:</strong> The code is fetched directly from GitHub each time the page is viewed, ensuring it's always up to date</li>
            <li><strong>Syntax Highlighting:</strong> Code is rendered with proper syntax highlighting based on the file extension</li>
            <li><strong>Line Range Selection:</strong> Display only specific portions of a file by specifying line numbers</li>
            <li><strong>Multiple Theme Options:</strong> Choose from several syntax highlighting themes to match your Confluence theme</li>
        </ul>
        
        <h2 id="troubleshooting">Troubleshooting</h2>
        
        <h3 id="common-issues">Common Issues</h3>
        
        <h4>Error: "GitHub URL is missing or empty"</h4>
        <div class="error">
            <p>This error occurs when you try to insert a GitHub Code Block without providing a URL.</p>
            <p><strong>Solution:</strong> Make sure to enter a valid GitHub URL in the GitHub URL field.</p>
        </div>
        
        <h4>Error: "Failed to fetch code from GitHub"</h4>
        <div class="error">
            <p>This error occurs when the app cannot retrieve the code from the provided GitHub URL.</p>
            <p><strong>Solutions:</strong></p>
            <ul>
                <li>Verify that the URL is correct and points to a valid file on GitHub</li>
                <li>Check if the GitHub repository is private - this app only works with public repositories</li>
                <li>Ensure the URL format is correct: <code>https://github.com/user/repo/blob/branch/path/to/file</code></li>
            </ul>
        </div>
        
        <h4>Error: "Invalid line range format"</h4>
        <div class="error">
            <p>This error occurs when the line range is not formatted correctly.</p>
            <p><strong>Solution:</strong> Use the format <code>start-end</code> for a range (e.g., <code>10-20</code>) or just a single number for a single line (e.g., <code>15</code>).</p>
        </div>
        
        <h4>Macro Not Rendering Properly</h4>
        <div class="warning">
            <p>If the macro is not rendering properly or shows up as a placeholder, try these steps:</p>
            <ol>
                <li>Refresh the Confluence page</li>
                <li>Edit the macro and save it again without making changes</li>
                <li>Clear your browser cache and reload the page</li>
                <li>If you recently updated the app, try uninstalling and reinstalling it</li>
            </ol>
        </div>
        
        <h3 id="scroll-viewport-issues">Scroll Viewport Issues</h3>
        <div class="warning">
            <p>If code blocks aren't rendering in Scroll Viewport:</p>
            <ol>
                <li>Verify you've added the custom JavaScript to your theme as shown in the <a href="#scroll-viewport-integration">Scroll Viewport Integration</a> section</li>
                <li>Check your browser console for any JavaScript errors</li>
                <li>Try adding <code>?disable-custom-overrides=true</code> to your URL and then remove it to refresh the custom JS</li>
                <li>Make sure the macro is creating the correct marker format in Confluence</li>
            </ol>
        </div>
        
        <h3 id="caching-issues">Caching Issues</h3>
        <p>Confluence may cache content and macros. If you're experiencing issues with the GitHub Code Block not updating:</p>
        <ol>
            <li>Try editing the page and saving it without making changes</li>
            <li>Clear your browser cache</li>
            <li>Wait a few minutes and refresh the page</li>
        </ol>
        
        <h2 id="security-considerations">Security Considerations</h2>
        <div class="note">
            <p><strong>Important:</strong> This app only works with public GitHub repositories. It cannot access private repositories.</p>
            <p>The app does not store any content from GitHub repositories. It fetches the content directly from GitHub each time the page is viewed.</p>
        </div>
        
        <h2 id="limitations">Limitations</h2>
        <ul>
            <li>Only works with public GitHub repositories</li>
            <li>Maximum file size that can be rendered is 1MB</li>
            <li>Does not support rendering binary files or images</li>
            <li>GitHub rate limits may apply if many code blocks are rendered in a short period</li>
        </ul>
        
        <div class="footer">
            <p>GitHub Code Renderer &copy; 2023 Apryse</p>
            <p>For support, please contact <a href="mailto:support@apryse.com">support@apryse.com</a></p>
        </div>
    </div>
</body>
</html> 